<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Create Course - ActivWork Training Portal</title>
    <style>
        /* Custom scrollbar styling for text areas */
        textarea::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        textarea::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        
        textarea::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
            transition: background 0.2s ease;
        }
        
        textarea::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Dark mode scrollbar */
        .dark textarea::-webkit-scrollbar-track {
            background: #374151;
        }
        
        .dark textarea::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
        
        .dark textarea::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
        
        /* Firefox scrollbar styling */
        textarea {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
        
        .dark textarea {
            scrollbar-color: #6b7280 #374151;
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <!-- Page Header -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-2">
            <i class="fas fa-plus-circle mr-2"></i>Create New Course
        </h1>
        <p class="text-gray-600 dark:text-gray-400">
            Fill in the details to create your course
        </p>
    </div>
    
    <!-- Course Form -->
    <form th:action="@{/instructor/courses/create}" 
          th:object="${courseCreateDto}" 
          method="post"
          enctype="multipart/form-data"
          class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8">
        
        <!-- Basic Information Section -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-6 pb-3 border-b border-gray-200 dark:border-gray-700">
                <i class="fas fa-info-circle mr-2"></i>Basic Information
            </h2>
            
            <div class="space-y-6">
                <!-- Course Title -->
                <div>
                    <label for="title" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Course Title <span class="text-red-500">*</span>
                    </label>
                    <input type="text" 
                           id="title" 
                           th:field="*{title}" 
                           required
                           class="block w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500"
                           placeholder="e.g., Java Spring Boot Fundamentals">
                    <p th:if="${#fields.hasErrors('title')}" 
                       th:errors="*{title}" 
                       class="mt-1 text-sm text-red-600 dark:text-red-400"></p>
                </div>
                
                <!-- Course Summary -->
                <div>
                    <label for="summary" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Short Summary <span class="text-red-500">*</span>
                    </label>
                    <textarea id="summary" 
                              th:field="*{summary}" 
                              required
                              rows="2"
                              class="block w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500"
                              placeholder="Brief one-line description of your course"></textarea>
                    <p th:if="${#fields.hasErrors('summary')}" 
                       th:errors="*{summary}" 
                       class="mt-1 text-sm text-red-600 dark:text-red-400"></p>
                </div>
                
                <!-- Course Description -->
                <div>
                    <label for="description" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Detailed Description <span class="text-red-500">*</span>
                    </label>
                    <textarea id="description" 
                              th:field="*{description}" 
                              required
                              rows="6"
                              class="block w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500"
                              placeholder="Provide a comprehensive description of what students will learn..."></textarea>
                    <p th:if="${#fields.hasErrors('description')}" 
                       th:errors="*{description}" 
                       class="mt-1 text-sm text-red-600 dark:text-red-400"></p>
                </div>
                
                <!-- Course Banner -->
                <div>
                    <label for="bannerFile" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 cursor-pointer">
                        Course Banner / Thumbnail
                    </label>
                    <input type="file" 
                           id="bannerFile" 
                           name="bannerFile"
                           accept="image/*"
                           class="block w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100 dark:file:bg-primary-900 dark:file:text-primary-300 cursor-pointer"
                           onchange="previewBanner(event)">
                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                        Upload an image for your course card (JPG, PNG, max 5MB). Recommended size: 1200x630px
                    </p>
                    <!-- Banner Preview -->
                    <div id="bannerPreview" class="mt-3 hidden">
                        <img id="bannerPreviewImg" class="rounded-lg max-h-48 object-cover" alt="Banner preview">
                    </div>
                </div>
                
                <!-- Category -->
                <div>
                    <label for="category" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Category <span class="text-red-500">*</span>
                    </label>
                    <select id="category" 
                            th:field="*{category}" 
                            required
                            class="block w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500">
                        <option value="">Select Category</option>
                        <option th:each="cat : ${T(com.activwork.etms.model.CourseCategory).values()}" 
                                th:value="${cat}" 
                                th:text="${cat.getDisplayName()}">
                        </option>
                    </select>
                    <p th:if="${#fields.hasErrors('category')}" 
                       th:errors="*{category}" 
                       class="mt-1 text-sm text-red-600 dark:text-red-400"></p>
                </div>
                
                <!-- Duration -->
                <div>
                    <label for="durationHours" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Duration (Hours) <span class="text-red-500">*</span>
                    </label>
                    <input type="number" 
                           id="durationHours" 
                           th:field="*{durationHours}" 
                           required
                           min="1"
                           class="block w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500"
                           placeholder="e.g., 10">
                    <p th:if="${#fields.hasErrors('durationHours')}" 
                       th:errors="*{durationHours}" 
                       class="mt-1 text-sm text-red-600 dark:text-red-400"></p>
                </div>
                
                <!-- Learning Objectives -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Learning Objectives
                    </label>
                    <div id="learningObjectivesContainer" class="space-y-3">
                        <div class="flex items-center gap-3">
                            <input type="text" 
                                   name="learningObjectives" 
                                   placeholder="Enter a learning objective"
                                   class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500"
                                   onkeypress="handleEnterKey(event, 'learningObjectives')">
                            <button type="button" 
                                    onclick="removeField(this)" 
                                    class="px-3 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg transition hidden remove-btn">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" 
                            onclick="addField('learningObjectives')" 
                            class="mt-3 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white text-sm font-medium rounded-lg transition">
                        <i class="fas fa-plus mr-2"></i>Add Objective
                    </button>
                </div>
                
                <!-- Prerequisites -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        Prerequisites
                    </label>
                    <div id="prerequisitesContainer" class="space-y-3">
                        <div class="flex items-center gap-3">
                            <input type="text" 
                                   name="prerequisites" 
                                   placeholder="Enter a prerequisite"
                                   class="flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500"
                                   onkeypress="handleEnterKey(event, 'prerequisites')">
                            <button type="button" 
                                    onclick="removeField(this)" 
                                    class="px-3 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg transition hidden remove-btn">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <button type="button" 
                            onclick="addField('prerequisites')" 
                            class="mt-3 px-4 py-2 bg-primary-600 hover:bg-primary-700 text-white text-sm font-medium rounded-lg transition">
                        <i class="fas fa-plus mr-2"></i>Add Prerequisite
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Form Actions -->
        <div class="flex flex-col md:flex-row gap-4 pt-6 border-t border-gray-200 dark:border-gray-700">
            <button type="submit" 
                    class="flex-1 py-3 px-6 bg-primary-600 hover:bg-primary-700 dark:bg-primary-500 dark:hover:bg-primary-600 text-white font-semibold rounded-lg shadow-md transition">
                <i class="fas fa-save mr-2"></i>Create Course
            </button>
            
            <a th:href="@{/instructor/courses}" 
               class="flex-1 py-3 px-6 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-900 dark:text-white text-center font-semibold rounded-lg transition">
                <i class="fas fa-times mr-2"></i>Cancel
            </a>
        </div>
    </form>
    
    <!-- Banner Preview Script -->
    <script>
        function previewBanner(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('bannerPreview');
                    const img = document.getElementById('bannerPreviewImg');
                    img.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        // Dynamic field management for Learning Objectives and Prerequisites
        function addField(fieldType) {
            const container = document.getElementById(fieldType + 'Container');
            const fieldCount = container.children.length;
            
            // Create new field wrapper
            const fieldWrapper = document.createElement('div');
            fieldWrapper.className = 'flex items-center gap-3';
            
            // Create input field
            const input = document.createElement('input');
            input.type = 'text';
            input.name = fieldType;
            input.placeholder = fieldType === 'learningObjectives' ? 'Enter a learning objective' : 'Enter a prerequisite';
            input.className = 'flex-1 px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500';
            input.onkeypress = function(e) { handleEnterKey(e, fieldType); };
            
            // Create remove button
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.onclick = function() { removeField(this); };
            removeBtn.className = 'px-3 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg transition';
            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
            
            // Append elements
            fieldWrapper.appendChild(input);
            fieldWrapper.appendChild(removeBtn);
            container.appendChild(fieldWrapper);
            
            // Show remove buttons if more than one field
            updateRemoveButtons(fieldType);
            
            // Focus on the new input
            input.focus();
        }

        function removeField(button) {
            const fieldWrapper = button.parentElement;
            const container = fieldWrapper.parentElement;
            const fieldType = fieldWrapper.querySelector('input').name;
            
            // Don't remove if it's the last field
            if (container.children.length > 1) {
                fieldWrapper.remove();
                updateRemoveButtons(fieldType);
            }
        }

        function updateRemoveButtons(fieldType) {
            const container = document.getElementById(fieldType + 'Container');
            const removeButtons = container.querySelectorAll('.remove-btn');
            
            // Show remove buttons only if there's more than one field
            removeButtons.forEach(btn => {
                if (container.children.length > 1) {
                    btn.classList.remove('hidden');
                } else {
                    btn.classList.add('hidden');
                }
            });
        }

        function handleEnterKey(event, fieldType) {
            if (event.key === 'Enter') {
                event.preventDefault();
                addField(fieldType);
            }
        }

        // Initialize remove button visibility on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateRemoveButtons('learningObjectives');
            updateRemoveButtons('prerequisites');
        });
    </script>
</div>
</body>
</html>

